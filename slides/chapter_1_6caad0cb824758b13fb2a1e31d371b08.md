---
title: Insert title here
key: 6caad0cb824758b13fb2a1e31d371b08

---
## Introduction Data Streams

```yaml
type: "TitleSlide"
key: "d592b1be4d"
```

`@lower_third`

name: Matthias Voppichler
title: Potential Instructor at Datacamp


`@script`
Welcome Back.
>> 

Data streams are a constant stream of data.
Examples include, but are not limited to
  * Twitter messages
  * News Articles
  * Video streams
  * sensor data or IOT
  * Market orders (financial)

Covering everything in this course would be too much, therefore we'll specifically focus on
>> 
Sensor data or IOT. 

>> 
To subscribe to a Datastream, we'll need a broker. We'll use MQTT for this, which is a publish/subscribe messaging protocol, designed to have a small footprint, making it ideal for IOT usecases.

An MQTT system consists of a client connecting to a server (also called Broker), and this client can then either publish (produce) data to a topic, or subscribe to data in one or multiple topics.

During this course, we'll only act as a client subscribing to a Topic, assuming a producer is available and producing data in the predefined topic for us.

>> 
Now let's dive straight into the code.

We'll import the module `paho.mqtt.subscribe` as subscribe.

We're going to use a concept called callback to subscribe to a topic, which is a very efficient way to wait for things to happen on the other end.
This calls our function print_msg whenever a new message is available.

We can now simply use subscribe.callback, with 
* the function as the first argument, 
* the topic to subscribe ("datacamp/roomtemp") as the 2nd argument
* and the server or broker as the third argument

More information and the documentation for the library is available under the projects github page.


---
## What is a Data Stream

```yaml
type: "FullSlide"
key: "967040be62"
disable_transition: true
```

`@part1`
* Constant stream of Data
* Examples {{1}}
  * Twitter messages {{1}}
  * News Articles {{2}}
  * Video streams {{3}}
  * Sensor data (IOT) {{4}}
  * Market orders (financial) {{5}}


`@script`
Data streams are a constant stream of data.
Examples include, but are not limited to
  * Twitter messages
  * News Articles
  * Video streams
  * sensor data or IOT
  * Market orders (financial)

Covering everything in this course would be too much, therefore we'll specifically focus on


---
## What is a Data stream

```yaml
type: "FullSlide"
key: "1d9a974dca"
```

`@part1`
* Constant stream of Data
* Examples
  * Twitter messages
  * News Articles
  * Video streams
  * **Sensor data (IOT)**
  * Market orders (financial)


`@script`
Sensor data or IOT. 

So let's dive straight in


---
## MQTT

```yaml
type: "FullSlide"
key: "2684c32418"
center_content: false
```

`@part1`
Features: 
* publish / subscribe message protocol
* Small footprint

Server -> Acts as message Broker {{3}}

Client: {{4}}
* connects to a Server (Broker) {{4}}
* publishes data to a topic  {{4}}
* Subscribes to one or more topics  {{4}}


`@script`
To subscribe to a Datastream, we'll need a broker. We'll use MQTT for this, which is a publish/subscribe messaging protocol, designed to have a small footprint, making it ideal for IOT usecases.

An MQTT system consists of a client connecting to a server (also called Broker), and this client can then either publish (produce) data to a topic, or subscribe to data in one or multiple topics.

During this course, we'll only act as a client subscribing to a Topic, assuming a producer is available and producing data in the predefined topic for us.


---
## paho.mqtt

```yaml
type: "FullSlide"
key: "4cb8ea09e6"
```

`@part1`
``` python
import paho.mqtt.subscribe as subscribe

``` {{1}}

``` python
subscribe.callback(on_message, "datacamp/roomtemp", hostname="test.mosquitto.org")
``` {{2}}


More information and the documentation for the library is available at github [https://github.com/eclipse/paho.mqtt.python](https://github.com/eclipse/paho.mqtt.python){{3}}


`@script`
Now let's dive straight into the code.

We'll import the module `paho.mqtt.subscribe` as subscribe.

We're going to use a concept called callback to subscribe to a topic, which is a very efficient way to wait for things to happen on the other end.
This calls our function print_msg whenever a new message is available.

We can now simply use subscribe.callback, with 
* the function as the first argument, 
* the topic to subscribe ("datacamp/roomtemp") as the 2nd argument
* and the server or broker as the third argument

More information and the documentation for the library is available under the projects github page.


---
## Callback method

```yaml
type: "FullSlide"
key: "17d6d90a30"
```

`@part1`
``` python
def on_message(client, userdata, message):
    print("{} : {}".format(message.topic, message.payload))
        
```


`@script`
Next, we need to define the function which is called whenever a new message arrives. 

The function-header is defined by the paho.mqtt library and needs to have the arguments 
* client, the client instance for this callback
* userdata, the private user data set when creating the instance
* message, an instance of MQTTMessage. This is a class with the properties `topic`, `payload`, `qos`, and `retain`

We're free to select any function name. A commonly used name includes "on_message", and we'll stick to that for this course.

For now, we'll print the message topic and the message payload, seperated by a colon.


---
## Putting it all together

```yaml
type: "FullSlide"
key: "71b1695c5c"
```

`@part1`
``` python
import paho.mqtt.subscribe as subscribe

def on_message(client, userdata, message):
    print("{} : {}".format(message.topic, message.payload))
        
subscribe.callback(on_message, 
                   topics="datacamp/roomtemp", 
                   hostname="test.mosquitto.org")
``` {{1}}


```
datacamp/roomtemp : b'{"time": 1543000557444, "hum": 34, "temp": 24}'
datacamp/roomtemp : b'{"time": 1543000558061, "hum": 24, "temp": 17}'
``` {{2}}


`@script`
Let's put it all together.
First, we import paho.mqtt.suscribe as subscribe.

Then, we define our function print_msg as done on the previous slide,

and then pass this function as the first argument to subscribe.callback, the topic name (datacamp/roomtemp) as second argument, and the hostname for the mqtt server as 3rd argument.

Once we launch our Script, we'll see the following output.

We see the topic on the left of the colon, as well as the message payload on the right, which is a json object in this case, containing the time, temperature and humidity from an environmental sensor.

In order to stop this script, we'll need to send an interupt or press ctrl+c. We'll see how to fix this in the next lession.


---
## Let's practice!

```yaml
type: "FinalSlide"
key: "dcea8fa2fd"
```

`@script`
And now, let's Practice. Have Fun

